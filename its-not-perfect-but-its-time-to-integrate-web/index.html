

<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!-->
<html class="no-js" lang="zh">
  <!--<![endif]-->
  <head>
    <meta charset="UTF-8">

    <title>
        It's not perfect but it's time to integrate web notifications
 - Pragmatic.ly Blog
    </title>

    <meta name="description" content="The voice of The Pragmatic.ly Team sharing Nes, Thoughts & Fun.">
    <meta name="keywords" content="  ["html5 notification", "JavaScript", "web notification"]
">
    <meta name="author" content="The Pragmatic.ly Team">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="cleartype" content="on">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="57x57" href="/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon-precomposed.png">
    <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">

    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <link rel="shortcut icon" sizes="16x16" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" title="Pragmatic.ly Blog Feed" href="/feed.xml" />
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/stylesheets/application.css?1365087764" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/application.js?1365087764" type="text/javascript"></script>

    <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script>
    <script type="text/javascript">var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4054156-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();</script>
  </head>

  <body class="its-not-perfect-but-its-time-to-integrate-web its-not-perfect-but-its-time-to-integrate-web_index">
    <header id="header">
      <div class="container">
        <a href="/" class="logo">Pragmatic.ly Blog</a>

        <ul class="top-nav">
          <li><a href="https://pragmatic.ly/tour">Tour</a></li>
          <li><a href="https://pragmatic.ly/signup">Sign Up</a></li>
          <li><a href="https://pragmatic.ly/login">Login</a></li>
        </ul>
      </div>
    </header>

    <section class="main">
      <div class="container">
          <article class="post">

    <header>
  <h2 class="title">
    <a href="/its-not-perfect-but-its-time-to-integrate-web">It's not perfect but it's time to integrate web notifications</a>
  </h2>
</header>

<aside>
  <ul class="meta">
    <li class="date">
      Aug 01, 2012
    </li>
    <li class="author">
     by <a href="https://pragmatic.ly/about">Dingding Ye</a>
    </li>
    <li class="tags">
      
        <a href="/tags/html5-notification">html5 notification</a>
      
        <a href="/tags/javascript">JavaScript</a>
      
        <a href="/tags/web-notification">web notification</a>
      
    </li>
  </ul>
</aside>

<div class="content">
  <p>One feature <a href="https://pragmatic.ly">Pragmatic.ly</a> has had from the beginning is Web Notifications. When I first saw the feature in Gmail I was convinced it was a feature every web application should have. As a project management tool Pragmatic.ly should enhance collaboration and ease communication. Instant desktop-like notification is one way to achieve the goal.</p>

<p><img title="Chrome Web Notification" alt="Chrome Web Notification" width="332" height="127" src="/images/its-not-perfect-but-its-time-to-integrate-web/chrome-notification.png?1365087763" /></p>

<p><img title="Safari Web Notification" alt="Safari Web Notification" width="331" height="92" src="/images/its-not-perfect-but-its-time-to-integrate-web/safari-notification.png?1365087763" /></p>

<h3>Browser Support</h3>

<p>For a long time only Chrome users have been able to benefit from such features. But the release of Safari 6 in Mountain Lion has changed things for the better and now it&#39;s time to integrate web notification into your application.</p>

<table><thead>
<tr>
<th align="center"><strong>Browser</strong></th>
<th align="left"><strong>Whether Support</strong></th>
</tr>
</thead><tbody>
<tr>
<td align="center">Chrome</td>
<td align="left">Yes</td>
</tr>
<tr>
<td align="center">Safari</td>
<td align="left">Yes. version 6 in Mountain Lion only</td>
</tr>
<tr>
<td align="center">Firefox</td>
<td align="left">Yes. Install Plugin <a href="https://code.google.com/p/ff-html5notifications">ff-html5notifications</a></td>
</tr>
<tr>
<td align="center">IE</td>
<td align="left">No. But can work in <a href="https://developers.google.com/chrome/chrome-frame/">Chrome Frame</a></td>
</tr>
</tbody></table>

<p>For more list, checkout <a href="https://html5test.com/compare/feature/notifications-notifications.html">https://html5test.com/compare/feature/notifications-notifications.html</a>.</p>

<p>Since different browsers support the notifications in different ways, there are two specs of web notifications we need to cover. One is the <a href="http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification">older version</a> which is implemented in latest version of Chromium, and the other is the <a href="http://www.w3.org/TR/notifications/">newer version</a> at W3C which safari followed. (The Firefox plugin followed the Chromium implementation). Considering safari 6 also does support the old spec, I would say it&#39;s better to still stick in the old spec, at least for now.</p>

<h3>How to Use</h3>

<p>Danger Cove wrote an awesome <a href="http://dangercove.github.com/html5-notifications/">demo</a> on how to use HTML5 web notifications, based on the old spec. If you&#39;re looking for the samples of the new spec, <a href="https://developer.apple.com/library/safari/#documentation/AppleApplications/Conceptual/SafariJSProgTopics/Articles/SendingNotifications.html">safari document</a> definitely is a good resource. Below are several notes from the experience I added the integration.</p>

<ol>
<li>The request permission dialog only shows after user interactions. Automation such as usingJavascript to click the link/button doesn&#39;t work.</li>
<li>requestPermission requires the callback to make it work with Safari</li>
<li>You can interact with your application using events such as onclick, by referring window.parent. For example as in Pragmatic.ly, when user clicks the popup notification, it will show you the ticket where event happens.</li>
</ol>

<p>Check the <a href="https://gist.github.com/3233112">Gist</a> to see how <a href="https://pragmatic.ly">Pragmatic.ly</a> integrates web notifications.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nx">Notifier</span>
  <span class="nv">constructor: </span><span class="nf">-&gt;</span>
    <span class="vi">@enableNotification = </span><span class="kc">false</span>
    <span class="nx">@checkOrRequirePermission</span><span class="p">()</span>

  <span class="nv">hasSupport: </span><span class="nf">-&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">webkitNotifications</span><span class="o">?</span>

  <span class="nv">requestPermission: </span><span class="nf">(cb) -&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">webkitNotifications</span><span class="p">.</span><span class="nx">requestPermission</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span>

  <span class="nv">setPermission: </span><span class="o">=&gt;</span>
    <span class="k">if</span> <span class="nx">@hasPermission</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;body .notification-alert a.close&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
      <span class="vi">@enableNotification = </span><span class="kc">true</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitNotifications</span><span class="p">.</span><span class="nx">checkPermission</span><span class="p">()</span> <span class="o">is</span> <span class="mi">2</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&#39;body .notification-alert a.close&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>

  <span class="nv">hasPermission: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitNotifications</span><span class="p">.</span><span class="nx">checkPermission</span><span class="p">()</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="kc">false</span>

  <span class="nv">checkOrRequirePermission: </span><span class="o">=&gt;</span>
    <span class="k">if</span> <span class="nx">@hasSupport</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@hasPermission</span><span class="p">()</span>
        <span class="vi">@enableNotification = </span><span class="kc">true</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitNotifications</span><span class="p">.</span><span class="nx">checkPermission</span><span class="p">()</span> <span class="o">isnt</span> <span class="mi">2</span>
          <span class="nx">@showTooltip</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;Desktop notifications are not supported for this Browser/OS version yet.&quot;</span><span class="p">)</span>

  <span class="nv">showTooltip: </span><span class="nf">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">JST</span><span class="p">[</span><span class="s">&quot;app/views/lib/notification_info&quot;</span><span class="p">]())</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;body .notification-alert&#39;</span><span class="p">).</span><span class="nx">on</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="s">&#39;a#link_enable_notifications&#39;</span><span class="p">,</span> <span class="nf">(e) =&gt;</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@requestPermission</span><span class="p">(</span><span class="nx">@setPermission</span><span class="p">)</span>

  <span class="nv">visitUrl: </span><span class="nf">(url) -&gt;</span>
    <span class="nx">Spine</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>

  <span class="nv">notify: </span><span class="nf">(avatar, title, content, url = null) -&gt;</span>
    <span class="k">if</span> <span class="nx">@enableNotification</span>
      <span class="nv">popup = </span><span class="nb">window</span><span class="p">.</span><span class="nx">webkitNotifications</span><span class="p">.</span><span class="nx">createNotification</span><span class="p">(</span><span class="nx">avatar</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">url</span>
        <span class="nv">popup.onclick = </span><span class="nf">-&gt;</span>
          <span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
          <span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">notifier</span><span class="p">.</span><span class="nx">visitUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
      <span class="nx">popup</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">setTimeout</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="nx">popup</span><span class="p">.</span><span class="nx">cancel</span><span class="p">()</span> <span class="p">),</span> <span class="mi">12000</span>

<span class="nb">window</span><span class="p">.</span><span class="nv">Notifier = </span><span class="nx">Notifier</span>
</pre></div>
<h3>Limitation</h3>

<p>While Safari 6 in Mountain Lion brings the support, it also brings some limitations, for example,</p>

<ol>
<li>Custom icons aren&#39;t supported any more in Mountain Lion, no matter which browser you use. It&#39;s controlled by the Notification Center and will always show the application icon such as Safari, Chrome. However, users in other OS doesn&#39;t have the problem. Hope Apple can fix it soon.</li>
<li>Title is truncated to 30 characters in Mountain Lion. So does body. However, you can view the whole body in the Notification Center.</li>
<li>You can&#39;t control how the notifications close in Mountain Lion. It&#39;s taken by the Notification Center setting.</li>
<li>HTML Notification doesn&#39;t work in Safari because the new W3C spec only have simple notification. So I suggest using simple notification only in your application.</li>
</ol>

<h3>One More Thing</h3>

<p>If you&#39;re developing Chrome extensions, do remember to add the &ldquo;notifications&rdquo; permission in the manifest.json. So when users install the extensions, the permission will be automatically granted. For Safari extensions, nothing needs to be added since it&#39;s handled by Safari with permission auto granted.</p>

<p><br/></p>

<h3>About Pragmatic.ly</h3>

<p><a href="https://pragmatic.ly">Pragmatic.ly</a> is a lean collaborative project management tool aiming to help small teams make better products easier. It&#39;s the ideal and elegant project management tool for tech startups.</p>

<p>Now that you&#39;ve read so far, you should follow me <a href="https://twitter.com/yedingding">@yedingding</a>!</p>

</div>

<div class="share">
  <a href="https://twitter.com/share?url=http://blog.pragmatic.ly/its-not-perfect-but-its-time-to-integrate-web&text=It's not perfect but it's time to integrate web notifications" class="twitter-share-button" data-lang="en"></a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  <div class="fb-like" data-href="http://blog.pragmatic.ly/its-not-perfect-but-its-time-to-integrate-web" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>

  <!-- Place this tag where you want the share button to render. -->
  <div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://blog.pragmatic.ly/its-not-perfect-but-its-time-to-integrate-web"></div>

  <!-- Place this tag after the last share tag. -->
  <script type="text/javascript">
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
  </script>

  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=372859719458672";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
</div>


  </article>
  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pragmaticlyblog'; // required: replace example with your forum shortname
    var disqus_identifier = 'it-s-not-perfect-but-it-s-time-to-integrate-web-notifications';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
    </section>

    <footer id="footer">
      <div class="container">
        <section id="blog-info">
          <div class="block about">
            <h5>ABOUT</h5>
            <p>Pragmatic.ly is a lean collaborative project management tool which help you make better products, easier. <a href="https://pragmatic.ly/" class="cta">Learn more →</a></p>
          </div>
          <div class="block authors">
            <h5>AUTHORS</h5>
            <ul class="contribs">
              <li><a href="#"><img src="/images/dingdingye.png" width="20px"> Dingding Ye</a></li>
              <li><a href="#"><img src="/images/terrytai.png" width="20px"> Terry Tai</a></li>
              <li><a href="#"><img src="/images/binhe.png" width="20px"> Bin He</a></li>
            </ul>
          </div>
          <div class="block follow">
            <h5>FOLLOW US</h5>
            <ul class="social-buttons">
              <li><a href="http://feeds.feedburner.com/pragmaticly" class="social-rss">RSS</a></li>
              <li><a href="https://twitter.com/pragmatic_ly" class="social-twitter">Twitter</a></li>
              <li><a href="https://facebook.com/pragmaticly" class="social-facebook">Facebook</a></li>
              <li><a href="https://plus.google.com/109049203627299997967" class="social-google">Google+</a></li>
            </ul>
          </div>

          <p class="copy">&copy; 2012-2013 Pragmatic.ly.</p>
        </section>

      </div><!-- .wrapper -->
    </footer>

    
  </body>
</html>
